<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í´ë¦­ ì¹´ìš´í„° ë­í‚¹ (ì‹œê°„ ì œí•œ)</title>
  <style>
    body {
      font-family: Ownglyph_PDH-Rg;
      text-align: center;
      padding-top: 100px;
      background-color: #fff4db;
      color: #625028;
    }
    #counter {
      font-size: 48px;
      margin-bottom: 20px;
      transition: transform 0.1s ease;
      font-family: Ownglyph_PDH-Rg;
    }
    #timer {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
      font-family: Ownglyph_PDH-Rg;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #ad8e47;
      color: white;
      cursor: pointer;
      font-family: Ownglyph_PDH-Rg;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    button:hover:enabled {
      background-color: #62512a;
    }
    #rankingList {
     list-style: none;
      padding-left: 0;
    }
  </style>
</head>
<body>
  <audio id="clickSound" src="https://www.myinstants.com/media/sounds/button_click.mp3"></audio>
  <h style="margin-bottom: 6px;">ì§€ìœ ì–‘ì˜ í´ë¦­ê²Œì„ê¸°...<br> ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì œí•œì‹œê°„ ë‚´ì— ìµœëŒ€í•œ ë§ì´ ëˆŒëŸ¬ ì¼ë“±ì„ ìŸì·¨í•˜ì„¸ìš”~</h>
  <h1 style="color:#43371c; margin-top: 6px;">ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì‹œì‘í•˜ì„¸ìš”</h1>
  <input type="text" id="nameInput" placeholder="ì´ë¦„ ì…ë ¥" style="width: 100px;
  height: 12px;
  font-family: Ownglyph_PDH-Rg;
  font-size: 17px;
  padding:  10px;
  margin-bottom: 10px;"/>
  <button onclick="startGame()">ì‹œì‘</button>

  <div id="gameArea" style="display:none; margin-top:20px;">
    <div id="timer">ë‚¨ì€ ì‹œê°„: 30ì´ˆ</div>
    <div id="counter">0</div>
    <button id="clickBtn" onclick="increaseCount()">í´ë¦­!</button>
  </div>

  <h2 style="color:#43371c">ğŸ† ë­í‚¹</h2>
  <ul id="rankingList"></ul>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyBaTz_2LwbtPhkgdTzZkj2xA15or_vgszo",
      authDomain: "click-button-1221.firebaseapp.com",
      projectId: "click-button-1221",
      storageBucket: "click-button-1221.firebasestorage.app",
      messagingSenderId: "108368565134",
      appId: "1:108368565134:web:68acae6141a82c6ab60adf",
      measurementId: "G-WD1XCYYKFC"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let count = 0;
    let currentName = "";
    let saveTimer = null;
    let countdownTimer = null;
    let timeLeft = 30; // ì œí•œ ì‹œê°„ (ì´ˆ)

    function startGame() {
      const nameInput = document.getElementById("nameInput").value.trim();
      if (!nameInput) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }
      currentName = nameInput;
      count = 0;
      timeLeft = 30;
      document.getElementById("counter").textContent = count;
      document.getElementById("timer").textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
      document.getElementById("gameArea").style.display = "block";
      document.getElementById("clickBtn").disabled = false;

      // ì €ì¥ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
      if (saveTimer) clearInterval(saveTimer);
      saveTimer = setInterval(saveScoreToFirestore, 3000);

      // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
      if (countdownTimer) clearInterval(countdownTimer);
      countdownTimer = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
        if (timeLeft <= 0) {
          clearInterval(countdownTimer);
          endGame();
        }
      }, 1000);

      // ì‹¤ì‹œê°„ ë­í‚¹ ê°±ì‹ 
      db.collection("scores").orderBy("score", "desc")
        .onSnapshot(loadRanking);
    }

    function increaseCount() {
      count++;
      const counterEl = document.getElementById("counter");
      counterEl.textContent = count;
      document.getElementById("clickSound").play();
      counterEl.style.transform = "scale(1.2)";
      setTimeout(() => counterEl.style.transform = "scale(1)", 100);
    }

    function saveScoreToFirestore() {
      if (!currentName) return;
      const userRef = db.collection("scores").doc(currentName);
      userRef.set({
        name: currentName,
        score: count,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true })
      .catch(err => console.error("ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨:", err));
    }

    function endGame() {
      // í´ë¦­ ê¸ˆì§€
      document.getElementById("clickBtn").disabled = true;
      // ìµœì¢… ì ìˆ˜ ì €ì¥
      saveScoreToFirestore();
      alert(`ì‹œê°„ ì¢…ë£Œ! ì ìˆ˜: ${count}ì `);
      clearInterval(saveTimer);
    }

    function loadRanking(snapshot) {
      const list = document.getElementById("rankingList");
      list.innerHTML = "";
      let rank = 1;
      let myItem = null;
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${rank}. ${data.name} : ${data.score} ì `;
        if (data.name === currentName) {
          li.style.fontWeight = "bold";
          li.style.color = "red";
          myItem = li;
        } else {
          list.appendChild(li);
        }
        rank++;
      });
      if (myItem) {
        const divider = document.createElement("li");
        divider.textContent = "ğŸ‘¤ ë‚´ ìˆœìœ„ ğŸ‘¤";
        divider.style.marginTop = "20px";
        divider.style.fontWeight = "bold";
        divider.style.color = "green";
        list.insertBefore(divider, list.firstChild);
        list.insertBefore(myItem, divider.nextSibling);
      }
    }
  </script>
</body>
</html>
